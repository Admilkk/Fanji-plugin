import fetch from 'node-fetch';
import fs from 'fs';
import path from 'path';
import yaml from 'js-yaml';
import cm from '../lib/common/CM.js';
import common from '../lib/common/common.js';
import { fileURLToPath } from 'url';
import https from 'https';
import { dirname } from 'path';
const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);
let ymzx = path.join(__dirname, `../resource/ymzx.jpg`)
//以下内容防君子不防小人
(function(_0x49a186,_0x339628){const _0x192409=_0x49a186();function _0x373f06(_0xbfa220,_0x4f42bd,_0x4cf3d4,_0x47f284){return _0x4743(_0xbfa220-0x25e,_0x4cf3d4);}function _0x354629(_0x3169ae,_0x3cc8bb,_0x10ebeb,_0x251f7a){return _0x4743(_0x3169ae- -0x313,_0x3cc8bb);}while(!![]){try{const _0x5a44f0=-parseInt(_0x373f06(0x345,0x346,0x360,0x328))/(0x1*0x493+0x885+-0xd17)+-parseInt(_0x354629(-0x1f4,-0x1fd,-0x202,-0x203))/(0x7c4+-0x35f*0x8+0x1*0x1336)+parseInt(_0x354629(-0x209,-0x22a,-0x1e2,-0x1f4))/(-0x1534+-0x2b9+-0x1*-0x17f0)*(parseInt(_0x373f06(0x376,0x384,0x398,0x35f))/(0x1*0x2371+0x5f9+-0x2966))+parseInt(_0x373f06(0x377,0x362,0x38a,0x374))/(-0x5d*-0x3d+0x10*0x5+0x3*-0x77c)*(-parseInt(_0x354629(-0x20f,-0x232,-0x209,-0x226))/(0x3*-0x671+-0x1c36+-0x1e7*-0x19))+-parseInt(_0x354629(-0x200,-0x21f,-0x223,-0x1f7))/(0x120a*0x1+-0x1877+0x674)+parseInt(_0x373f06(0x351,0x34a,0x369,0x33f))/(-0x247*0x4+0x23f1+-0x1acd)*(parseInt(_0x354629(-0x1f9,-0x1d9,-0x1e1,-0x201))/(-0x1075+0x24d6+-0x1458))+parseInt(_0x354629(-0x237,-0x248,-0x232,-0x261))/(0x692*0x1+0xd5+-0x75d);if(_0x5a44f0===_0x339628)break;else _0x192409['push'](_0x192409['shift']());}catch(_0x30c653){_0x192409['push'](_0x192409['shift']());}}}(_0x5877,-0x1b77+0x1d49f+0xcd73));const _0x3edd16=(function(){const _0x5baa55={};function _0x683d93(_0x3bcf5d,_0x4977de,_0x51fa20,_0x441ab1){return _0x4743(_0x4977de-0x80,_0x3bcf5d);}_0x5baa55['UGckf']='kyttg',_0x5baa55[_0x48d1b0(0x3e3,0x3fa,0x3e5,0x406)]=_0x48d1b0(0x3bf,0x3dd,0x3ee,0x3de);const _0x25ffb2=_0x5baa55;function _0x48d1b0(_0x171bf6,_0x3379c6,_0x4ee74b,_0x118b18){return _0x4743(_0x3379c6-0x2ef,_0x171bf6);}let _0x5f40c4=!![];return function(_0x4adaa8,_0x5c6658){const _0x1cf256=_0x5f40c4?function(){const _0x27a45e={};_0x27a45e[_0x22c7ff(-0xec,-0x10b,-0x11c,-0x115)]=_0x22c7ff(-0x154,-0x145,-0x17f,-0x156)+'+$';const _0x46cc81=_0x27a45e;function _0x22c7ff(_0x1dad52,_0x4c25fb,_0x4777a5,_0x59c37a){return _0x4743(_0x59c37a- -0x226,_0x4c25fb);}function _0x2c22e7(_0x2e349e,_0x4fd76a,_0x41d04a,_0x49f3d4){return _0x4743(_0x2e349e-0x229,_0x49f3d4);}if(_0x5c6658){if(_0x25ffb2[_0x22c7ff(-0x14a,-0x134,-0x161,-0x14d)]!==_0x25ffb2[_0x22c7ff(-0x11b,-0x124,-0x10f,-0x11b)]){const _0x9d5ec3=_0x5c6658[_0x22c7ff(-0x129,-0x13d,-0x14b,-0x13e)](_0x4adaa8,arguments);return _0x5c6658=null,_0x9d5ec3;}else return _0x5e8041[_0x2c22e7(0x30b,0x2f0,0x2e3,0x2f6)]()[_0x2c22e7(0x33e,0x357,0x33a,0x34f)](_0x46cc81[_0x22c7ff(-0xf7,-0x112,-0x120,-0x115)])[_0x2c22e7(0x30b,0x31d,0x2e4,0x30d)]()[_0x2c22e7(0x30c,0x32c,0x330,0x2ff)+'r'](_0x28c6b5)[_0x22c7ff(-0xfd,-0x110,-0xfa,-0x111)](_0x46cc81[_0x22c7ff(-0x13f,-0x10e,-0x12e,-0x115)]);}}:function(){};return _0x5f40c4=![],_0x1cf256;};}()),_0x546843=_0x3edd16(this,function(){const _0x650713={};_0x650713['YCFnp']=_0x3d66e8(0x2ed,0x2fd,0x2f3,0x2f3)+'+$';function _0x612625(_0x57032c,_0x34cc24,_0x5b7755,_0x2789d2){return _0x4743(_0x57032c-0x2a5,_0x34cc24);}function _0x3d66e8(_0x23150f,_0x59321a,_0x3ae61d,_0x46017f){return _0x4743(_0x46017f-0x223,_0x3ae61d);}const _0xaaaa11=_0x650713;return _0x546843[_0x3d66e8(0x2eb,0x30a,0x2f9,0x305)]()[_0x612625(0x3ba,0x3b9,0x3dc,0x3cf)](_0xaaaa11[_0x612625(0x37c,0x376,0x357,0x37e)])['toString']()[_0x3d66e8(0x2e9,0x309,0x2fd,0x306)+'r'](_0x546843)[_0x612625(0x3ba,0x3ba,0x3a2,0x392)](_0x612625(0x375,0x37e,0x38a,0x34f)+'+$');});function _0x4743(_0x336dba,_0x3ffc51){const _0x6f5f74=_0x5877();return _0x4743=function(_0x3f5f15,_0xbabbdf){_0x3f5f15=_0x3f5f15-(-0x161a+0x9a*0x25+0xa3);let _0x1bd431=_0x6f5f74[_0x3f5f15];if(_0x4743['RrRaTv']===undefined){var _0x1ac4dd=function(_0x239d7c){const _0x240d57='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0xbee380='',_0x3d5194='',_0xde03c5=_0xbee380+_0x1ac4dd;for(let _0x48258f=0x103d*-0x1+0x1*0x1e16+-0xdd9,_0x4fc68a,_0x558745,_0x48d8d3=0x8dc+-0xd25+0x449;_0x558745=_0x239d7c['charAt'](_0x48d8d3++);~_0x558745&&(_0x4fc68a=_0x48258f%(-0xfc9+0x19a1+-0x9d4)?_0x4fc68a*(-0x1d29*0x1+0x746+0x1623)+_0x558745:_0x558745,_0x48258f++%(-0x691*0x1+0x18f+-0x283*-0x2))?_0xbee380+=_0xde03c5['charCodeAt'](_0x48d8d3+(0x1ed1+-0x10cd+-0x6fd*0x2))-(0x17e*0x1+0x1*-0x1e58+-0x56*-0x56)!==0x1160+0xf*0x281+0x7*-0x7d9?String['fromCharCode'](-0x6*0x60c+0x2b8*0x7+0x3*0x615&_0x4fc68a>>(-(-0x5*0x731+-0x2613+0x4a0a)*_0x48258f&-0x3*-0x92f+-0x58f*-0x2+0xd*-0x2f9)):_0x48258f:-0x1*-0x17a+0x1e*0xc1+-0x1818){_0x558745=_0x240d57['indexOf'](_0x558745);}for(let _0x4e5600=-0x1006+-0x1*-0x25c+0xdaa,_0x29bf2b=_0xbee380['length'];_0x4e5600<_0x29bf2b;_0x4e5600++){_0x3d5194+='%'+('00'+_0xbee380['charCodeAt'](_0x4e5600)['toString'](0x14*0x18e+-0x25bf+0x6b7))['slice'](-(0x925*-0x1+0x1e1c+0x14f5*-0x1));}return decodeURIComponent(_0x3d5194);};_0x4743['aXxeXK']=_0x1ac4dd,_0x336dba=arguments,_0x4743['RrRaTv']=!![];}const _0x1dc4c9=_0x6f5f74[0x117e*0x1+-0x551*0x1+-0x3*0x40f],_0x12c437=_0x3f5f15+_0x1dc4c9,_0x2c4f83=_0x336dba[_0x12c437];if(!_0x2c4f83){const _0x8a3c10=function(_0x3a73a4){this['SgrYeO']=_0x3a73a4,this['UtsQBg']=[0x1*-0x21cd+0x239c+-0x1ce,0x1*0x1826+-0x3d*0x3+0x7*-0x359,-0x1c90+-0x5fe+-0x1*-0x228e],this['EdcEFg']=function(){return'newState';},this['RQDjOr']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['hxdHMZ']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x8a3c10['prototype']['YezHlI']=function(){const _0x5ea510=new RegExp(this['RQDjOr']+this['hxdHMZ']),_0x1fb7aa=_0x5ea510['test'](this['EdcEFg']['toString']())?--this['UtsQBg'][0x185*0x3+0x1*0x687+-0xb15]:--this['UtsQBg'][-0x15*0x4a+0xb83+-0x571];return this['jzmUFE'](_0x1fb7aa);},_0x8a3c10['prototype']['jzmUFE']=function(_0x50b08f){if(!Boolean(~_0x50b08f))return _0x50b08f;return this['UuXwDo'](this['SgrYeO']);},_0x8a3c10['prototype']['UuXwDo']=function(_0xe4bb22){for(let _0x371f39=0x2450+-0x262a*-0x1+-0x4a7a,_0x23974b=this['UtsQBg']['length'];_0x371f39<_0x23974b;_0x371f39++){this['UtsQBg']['push'](Math['round'](Math['random']())),_0x23974b=this['UtsQBg']['length'];}return _0xe4bb22(this['UtsQBg'][0xf09+0x22eb+-0x31f4]);},new _0x8a3c10(_0x4743)['YezHlI'](),_0x1bd431=_0x4743['aXxeXK'](_0x1bd431),_0x336dba[_0x12c437]=_0x1bd431;}else _0x1bd431=_0x2c4f83;return _0x1bd431;},_0x4743(_0x336dba,_0x3ffc51);}_0x546843();const _0x4ca2d2=(function(){function _0x5e1574(_0x27ede5,_0x3ff7a2,_0x2bc969,_0x47a98d){return _0x4743(_0x47a98d- -0x331,_0x27ede5);}function _0x2593ec(_0x9ff0e7,_0x315f71,_0x1ceab8,_0x1a916a){return _0x4743(_0x1a916a- -0xa1,_0x9ff0e7);}const _0x3d1304={'zCCFR':function(_0x53256e,_0x1554dc){return _0x53256e(_0x1554dc);},'zyBqg':_0x2593ec(0x4d,0x3c,0x45,0x3c)+'nction()\x20','zCaCr':_0x2593ec(0x5a,0x30,0x39,0x32)+_0x5e1574(-0x268,-0x230,-0x21e,-0x242)+_0x5e1574(-0x227,-0x20d,-0x205,-0x215)+'\x20)','tXvEY':function(_0x5d5736,_0x32374c){return _0x5d5736!==_0x32374c;},'GLOEA':function(_0x3dc279,_0x282aa5){return _0x3dc279===_0x282aa5;}};let _0x5c6153=!![];return function(_0x2346d2,_0x3ccc21){const _0x5776d2={'rneEm':function(_0x251c37,_0x39b1b9){function _0x1d0d66(_0xf5827e,_0x2ac215,_0x34d8ab,_0x262037){return _0x4743(_0x2ac215-0x4c,_0x34d8ab);}return _0x3d1304[_0x1d0d66(0x145,0x162,0x15d,0x165)](_0x251c37,_0x39b1b9);},'DiitS':_0x3d1304['zyBqg'],'wbuBD':_0x3d1304[_0x510506(0x204,0x21b,0x1d9,0x1e4)],'eZtKe':function(_0x522213,_0x2cbf03){function _0x880c58(_0xbf1690,_0x39926d,_0x1c209e,_0x281337){return _0x510506(_0x1c209e-0x21e,_0x39926d-0x1ae,_0x1c209e-0xb4,_0x281337);}return _0x3d1304[_0x880c58(0x424,0x45c,0x44c,0x451)](_0x522213,_0x2cbf03);},'RQLMr':_0x5c1bb4(0x8a,0x9a,0xb3,0x9c)};function _0x510506(_0x1f95ab,_0x1af1bd,_0x58ccab,_0x306f84){return _0x5e1574(_0x306f84,_0x1af1bd-0x10f,_0x58ccab-0xc,_0x1f95ab-0x46a);}function _0x5c1bb4(_0x24eb7a,_0x45bc38,_0x3e0d40,_0x82c8e2){return _0x5e1574(_0x3e0d40,_0x45bc38-0xbb,_0x3e0d40-0x189,_0x45bc38-0x2ea);}if(_0x3d1304[_0x510506(0x230,0x23e,0x22d,0x224)](_0x5c1bb4(0xaa,0x98,0x84,0x7e),'xYIRw')){const _0x10486a=_0x5776d2[_0x510506(0x206,0x1e1,0x21c,0x215)](_0x3a640d,_0x5776d2['DiitS']+_0x5776d2[_0x5c1bb4(0xb3,0x8f,0x6b,0xb4)]+');');_0x4929b0=_0x10486a();}else{const _0x22b0b2=_0x5c6153?function(){function _0x2da608(_0x22a0f2,_0x511479,_0x3298dd,_0x1314e0){return _0x510506(_0x1314e0- -0x521,_0x511479-0x4c,_0x3298dd-0x76,_0x22a0f2);}function _0x26b0a6(_0x3715dd,_0x477ccf,_0x5f23d7,_0x2c5d36){return _0x5c1bb4(_0x3715dd-0x1f,_0x477ccf-0x26d,_0x5f23d7,_0x2c5d36-0x118);}if(_0x5776d2[_0x26b0a6(0x341,0x322,0x316,0x322)](_0x5776d2[_0x26b0a6(0x32a,0x32b,0x32b,0x33e)],_0x5776d2[_0x2da608(-0x2f8,-0x305,-0x2c4,-0x2e3)]))_0x2847bd=_0x3dbcd8;else{if(_0x3ccc21){const _0x5754c2=_0x3ccc21[_0x26b0a6(0x2fd,0x30e,0x2fd,0x2e5)](_0x2346d2,arguments);return _0x3ccc21=null,_0x5754c2;}}}:function(){};return _0x5c6153=![],_0x22b0b2;}};}()),_0x3b4c4b=_0x4ca2d2(this,function(){const _0x2808ed={'fErkf':function(_0x3a4a8b,_0x24309c){return _0x3a4a8b(_0x24309c);},'UPJPX':function(_0x2eddee,_0x5890ca){return _0x2eddee+_0x5890ca;},'JhChN':_0x34756c(0x493,0x48e,0x49a,0x471)+_0x34756c(0x47e,0x482,0x498,0x48e),'YawAh':function(_0x3b11ec){return _0x3b11ec();},'poHlv':_0x2f9206(0x381,0x36c,0x390,0x395),'Fjlpv':_0x2f9206(0x35d,0x373,0x341,0x381),'SANsx':_0x2f9206(0x38f,0x39f,0x3a4,0x37b),'KRShn':_0x34756c(0x4c4,0x4c5,0x4b2,0x4eb),'xRlhj':_0x2f9206(0x387,0x35e,0x383,0x396),'uFfSd':_0x34756c(0x4a2,0x4ac,0x482,0x4ac),'HBLpu':function(_0x515e66,_0x5a757c){return _0x515e66<_0x5a757c;},'zWyNZ':function(_0x51d4c6,_0x41fd02){return _0x51d4c6(_0x41fd02);},'sNxmq':function(_0x397a94,_0x289bb9){return _0x397a94+_0x289bb9;},'yayrs':function(_0x3bb468,_0x44741a){return _0x3bb468+_0x44741a;},'mMnbV':function(_0x37d819){return _0x37d819();},'DxOmj':_0x34756c(0x480,0x49d,0x49f,0x4c4),'QvnVH':_0x2f9206(0x38c,0x3af,0x36e,0x36e),'jkvtn':_0x2f9206(0x399,0x3a4,0x398,0x388)};let _0x1bde5a;function _0x34756c(_0x477aa6,_0x2d4eca,_0x2016cc,_0x5969a0){return _0x4743(_0x2d4eca-0x3b1,_0x5969a0);}try{const _0x58156f=_0x2808ed[_0x2f9206(0x379,0x374,0x387,0x381)](Function,_0x2808ed['sNxmq'](_0x2808ed[_0x34756c(0x493,0x4be,0x4e1,0x499)](_0x2808ed[_0x2f9206(0x357,0x382,0x37c,0x34e)],'{}.constru'+'ctor(\x22retu'+_0x2f9206(0x3a5,0x388,0x38c,0x3a4)+'\x20)'),');'));_0x1bde5a=_0x2808ed['mMnbV'](_0x58156f);}catch(_0x25f227){if(_0x2808ed[_0x34756c(0x4f2,0x4cf,0x4d2,0x4ed)]===_0x2808ed[_0x2f9206(0x355,0x33e,0x367,0x37a)]){let _0x3aa023;try{const _0x2f22e0=_0x2808ed['fErkf'](_0x66e9e3,_0x2808ed['UPJPX'](_0x2808ed[_0x34756c(0x465,0x47f,0x498,0x49e)],_0x34756c(0x482,0x484,0x48e,0x497)+'ctor(\x22retu'+_0x34756c(0x4e1,0x4cd,0x4b7,0x4db)+'\x20)')+');');_0x3aa023=_0x2808ed['YawAh'](_0x2f22e0);}catch(_0x22871f){_0x3aa023=_0x4a205d;}const _0x23e648=_0x3aa023[_0x2f9206(0x382,0x39d,0x38b,0x375)]=_0x3aa023[_0x34756c(0x4c0,0x4aa,0x4b3,0x4ae)]||{},_0x4f4c2a=[_0x2808ed[_0x34756c(0x4d9,0x4bf,0x4a2,0x4ba)],_0x2808ed[_0x2f9206(0x36e,0x349,0x386,0x346)],_0x34756c(0x4d7,0x4c1,0x4ce,0x4b0),_0x2808ed['SANsx'],_0x2808ed[_0x34756c(0x4b4,0x4b0,0x4c6,0x4af)],_0x2808ed[_0x34756c(0x49b,0x480,0x45c,0x463)],_0x2808ed[_0x2f9206(0x38a,0x36e,0x36b,0x373)]];for(let _0xebb5f=0x2410+-0x1852+-0xbbe;_0x2808ed['HBLpu'](_0xebb5f,_0x4f4c2a['length']);_0xebb5f++){const _0x3fe022=_0x2ed0a2[_0x2f9206(0x36c,0x34b,0x364,0x365)+'r'][_0x2f9206(0x36f,0x34e,0x386,0x36d)][_0x2f9206(0x386,0x392,0x36d,0x384)](_0x5c791f),_0xd8db84=_0x4f4c2a[_0xebb5f],_0x7bc8a7=_0x23e648[_0xd8db84]||_0x3fe022;_0x3fe022[_0x34756c(0x4a1,0x48b,0x489,0x4a9)]=_0x3578ed[_0x2f9206(0x386,0x395,0x39e,0x399)](_0x4149f2),_0x3fe022['toString']=_0x7bc8a7[_0x34756c(0x490,0x493,0x48a,0x47c)][_0x2f9206(0x386,0x399,0x35e,0x37f)](_0x7bc8a7),_0x23e648[_0xd8db84]=_0x3fe022;}}else _0x1bde5a=window;}const _0x4f0c45=_0x1bde5a[_0x34756c(0x4a8,0x4aa,0x48a,0x499)]=_0x1bde5a[_0x34756c(0x483,0x4aa,0x4c0,0x489)]||{},_0x96fbfd=[_0x2808ed[_0x34756c(0x4be,0x4bf,0x4a5,0x4b3)],'warn',_0x2808ed[_0x2f9206(0x37d,0x39b,0x36d,0x35a)],'error',_0x2808ed[_0x2f9206(0x388,0x388,0x39a,0x387)],_0x2f9206(0x387,0x394,0x3b2,0x3a1),_0x2808ed[_0x2f9206(0x38a,0x39d,0x3af,0x381)]];function _0x2f9206(_0x45a815,_0x223351,_0x7d0699,_0x48299e){return _0x4743(_0x45a815-0x289,_0x223351);}for(let _0x1e6e7e=0x18e4+-0xaf*-0x2b+0x1*-0x3649;_0x1e6e7e<_0x96fbfd[_0x2f9206(0x3a0,0x3af,0x3bf,0x3c9)];_0x1e6e7e++){const _0x286a90=_0x4ca2d2[_0x34756c(0x4b3,0x494,0x4a3,0x48e)+'r'][_0x34756c(0x474,0x497,0x4a3,0x4b2)][_0x34756c(0x4cb,0x4ae,0x4c2,0x48d)](_0x4ca2d2),_0x34acfd=_0x96fbfd[_0x1e6e7e],_0x200519=_0x4f0c45[_0x34acfd]||_0x286a90;_0x286a90['__proto__']=_0x4ca2d2[_0x34756c(0x495,0x4ae,0x4b4,0x4a7)](_0x4ca2d2),_0x286a90['toString']=_0x200519[_0x2f9206(0x36b,0x384,0x369,0x365)][_0x34756c(0x4c0,0x4ae,0x4c9,0x49c)](_0x200519),_0x4f0c45[_0x34acfd]=_0x286a90;}});_0x3b4c4b();const tosendurl=_0x4569d1(-0x211,-0x207,-0x1f4,-0x1e4)+_0x4569d1(-0x1da,-0x201,-0x1d8,-0x1e6)+_0x4569d1(-0x1e4,-0x1f4,-0x1fb,-0x1cd)+_0x14f90b(0x161,0x198,0x175,0x14c)+_0x14f90b(0x156,0x13c,0x15b,0x146);function _0x14f90b(_0x45e0cf,_0x4cef20,_0x21ae60,_0x1463a9){return _0x4743(_0x21ae60-0x83,_0x45e0cf);}const tosendurl2=_0x4569d1(-0x22e,-0x207,-0x223,-0x204)+_0x14f90b(0x15c,0x173,0x167,0x162)+_0x4569d1(-0x1ff,-0x1f4,-0x1cf,-0x1d4)+_0x14f90b(0x15a,0x189,0x175,0x16f)+_0x4569d1(-0x21e,-0x20d,-0x20c,-0x21a),key='1812e7ebb6'+_0x14f90b(0x160,0x19e,0x185,0x186)+_0x4569d1(-0x1f9,-0x1dd,-0x1fc,-0x1ca)+'20580e5889'+_0x4569d1(-0x202,-0x205,-0x22d,-0x1f5)+_0x14f90b(0x177,0x17f,0x16d,0x164)+'608d786f2b'+_0x4569d1(-0x1e3,-0x1de,-0x1d2,-0x1e8)+_0x14f90b(0x192,0x182,0x1a0,0x17d)+_0x14f90b(0x1a0,0x18b,0x19e,0x194)+'dddc317b28'+'ce1b29dfe2'+_0x4569d1(-0x1d4,-0x1eb,-0x1ee,-0x1e4);function _0x5877(){const _0x3e5581=['DgfIBgu','s1jtAg4','zY9WAwmVExvHBG','DuzMu2q','nZC3otu0y2iWmq','C1bkt3u','oti0sM5nDNjI','uLfmtxi','zxjYB3i','yZHMyMfKzgu1ma','ogrHzMu3mJK1yG','zt1QC29UjM51Bq','mJa4odGXv1DsvfL1','EKj3EMq','CgKVyMfPC2KUCa','Ewf5CNm','Cg9iBhy','lNL1AM4Uy24Vyq','Aw5MBW','tfbcENC','Cc9PBwC','mtu1mdm1m1jMvKDJvG','zxHJzxb0Aw9U','C2vHCMnO','EKndrLi','BgvUz3rO','mtzwz2TKvfO','ntmZnwDPshL1sG','mJKZnZG2mwDJBMDXuG','ywqWzJGZndu0zG','CM4GDgHPCYiPka','otK3nMm2otiXmG','rhHpBwO','nZKYndjYCgzRAu4','EKnHq3i','uxzUvKG','CM5Lrw0','sMHdAe4','EfjSAgO','kcGOlISPkYKRkq','BMn0Aw9UkcKG','BNL4Es54ExOVzG','E30Uy29UC3rYDq','D2fYBG','Ahr0Chm6lY9TBW','D2j1qKq','wungBNa','p3bHC3m9','vuDJA2y','x19WCM90B19F','B2XPy29UlZ90Eq','mJGWnJy5meTLAKfQsW','CMv0DxjUicHMDq','Ahr0Chm6lY9HCa','wLjUzvC','mdC1yJfLmZC4yW','DfzQCMe','Dg9tDhjPBMC','y29UC3rYDwn0BW','As55Dw54AxL1yq','rMPSChy','ChjVDg90ExbL','mJK0nJu3ww9duK9z','yxbWBhK','BNL4Es54ExOVBa','yZKYmMm3zdK4za','Ahr0CdOVl2fWAq','uhH3AMy','CMvLBhKVp3r5Ca','sgHouLu','y3rVCIGICMv0Dq','ELD5tLO','BNL4Es54ExOVDq','CMWVBg9SAwnVBG','ogTSvKzIAG','AMT2Dg4','DfH2rvK','Cgu9Dgv4Da','r0Xprue','Bg9N','y29UC29Szq','yZfHnJjKnMi','DhjHy2u','zvP0s2u','yMLUza'];_0x5877=function(){return _0x3e5581;};return _0x5877();}let apiurl=_0x14f90b(0x13c,0x149,0x158,0x12f)+'e.anosu.to'+_0x4569d1(-0x1c1,-0x1d3,-0x1eb,-0x1c5);const apiurl2='https://ap'+'i.dujin.or'+_0x14f90b(0x180,0x162,0x183,0x162)+'shen/',apiurl3=_0x4569d1(-0x1ed,-0x1fa,-0x1f6,-0x1d4)+_0x14f90b(0x18c,0x186,0x192,0x193)+_0x14f90b(0x176,0x184,0x18f,0x165)+'hp';function _0x4569d1(_0x767976,_0x591f88,_0xffd970,_0x3d3c29){return _0x4743(_0x591f88- -0x2e5,_0x767976);}const apiurl4=_0x4569d1(-0x21c,-0x207,-0x21c,-0x226)+'i.yunxiyua'+_0x4569d1(-0x1e6,-0x1fc,-0x1e8,-0x1f6)+_0x14f90b(0x177,0x171,0x15e,0x168)+_0x4569d1(-0x20d,-0x1ef,-0x1c7,-0x219),apiurl5=_0x14f90b(0x155,0x15d,0x161,0x176)+_0x4569d1(-0x1db,-0x201,-0x217,-0x1f0)+_0x4569d1(-0x20f,-0x213,-0x228,-0x226)+_0x14f90b(0x160,0x189,0x170,0x160)+_0x14f90b(0x1a2,0x19a,0x18c,0x1a9)+'=';
const filepath = path.join(__dirname, '../config/config.yaml');
const apiurllol = 'https://api.lolicon.app/setu/v2';
const configContent = fs.readFileSync(filepath, 'utf8');
let config = yaml.load(configContent);

// 如果配置文件中没有 pixiv 项，则默认为 false 并创建该项
if (!config.hasOwnProperty('pixiv')) {
  config.pixiv = false;
  const updatedConfigContent = yaml.dump(config);
  fs.writeFileSync(filepath, updatedConfigContent, 'utf8');
}
if (config.pixiv === true) {
  apiurl = '\u0068\u0074\u0074\u0070\u0073\u003a\u002f\u002f\u006d\u006f\u0065\u002e\u006a\u0069\u0074\u0073\u0075\u002e\u0074\u006f\u0070\u002f\u0069\u006d\u0067';
}
export class apisetu extends plugin {
  constructor() {
    super({
      name: '反击',
      dsc: '反击!!!!',
      event: 'message',
      priority: -9999999999999999999999999999999999999999999999991,
      rule: [
        {
          reg: /^#?随机(涩|色|瑟|塞|se)图$/i, // 无r18.所以不套转发
          fnc: 'ptst',
        },
        {
          reg: /^#?随机(原|y|厵|○)(神|s|神|🈸)((图片)|图)?$/i, // 无r18.所以不套转发
          fnc: 'ys',
        },
        {
          reg: /^#?(来(\d+)张)?随机(r18)(图)?(\u5c01\u53f7\u7248)?$/i, // R18，套了转发
          fnc: 'r18',
        },
        {
          reg: /^#?随机(兽耳|furry)(图)?$/i, // 无r18.所以不套转发
          fnc: 'fr',
        },
		{
          reg: /^#?(随机)?(白丝|bs)(图)?$/i, // 无r18.所以不套转发
          fnc: 'bs',
        },
		{
          reg: /^#?(来(\d+)张)?随机(lol)(api)(图)?$/i, // 无r18.所以不套转发
          fnc: 'yxy',
        },
				{
          reg: /^#?(来(\d+)张)?随机杂(图)?$/i, // 无r18.所以不套转发
          fnc: 'zt',
        }
      ],
    });
  }
async yxy(e) {
  await e.reply('开始了');

  try {
    let num = e.msg.match(/(\d+)/);
    num = num && num[1] ? parseInt(num[1], 10) : 1;

    const messages = ['你要的图来啦'];
    let res;
    let imageUrls = [];
    let allImageLinks = '';
    let tosend = '';

    res = await fetch(`${apiurllol}?r18=2&num=${num}&excludeAI=true`);
    const result = await res.json();

    if (result.error) {
      throw new Error(`API Error: ${result.error}`);
    }

    for (const item of result.data) {
      const imageUrl = item.urls.original;
      imageUrls.push(imageUrl);
    }

    allImageLinks = imageUrls.join('\n\n');
    tosend = imageUrls.length === 1 ? imageUrls[0] : imageUrls.join('|');
  res = await fetch(`${tosendurl}${key}&url=${tosend}`);
  const data = await res.json();

  if (data.code != 0) {
    await e.reply(`至云溪院API失败，code: ${data.code}, msg: ${data.msg}`);
  }
      messages.push(...imageUrls.map((url) => [segment.image(url)]));
	const forwardMsg = common.makeForwardMsg(e, messages, '点击查看涩图');

    let aw = await e.reply(forwardMsg);

    if (!aw && imageUrls.length > 1) {
      await e.reply('消息被风控！\n' + allImageLinks);
    }
  } catch (error) {
    console.error(`Error in yxy function: ${error.message}`);
  }
}



/* async yxy(e) {
  await e.reply('开始了');
  try {
    let num = e.msg.match(/(\d+)/);
    num = num && num[1] ? parseInt(num[1], 10) : 1;
    const messages = ['你要的图来啦'];
    let res;
    let imageUrls = []; // 用于存储所有图片链接

      res = await fetch(apiurllol);
      const imageUrl = await res.text();

    const forwardMsg = common.makeForwardMsg(e, messages, '点击查看涩图');
    let aw = await e.reply(forwardMsg);
    if (!aw && imageUrls.length > 1) {
      const allImageLinks = imageUrls.join('\n');
      await e.reply('消息被风控！\n' + allImageLinks);
    }
  } catch (error) {
    console.error(`Error in yxy function: ${error.message}`);
  }
} */
async zt(e) {
  await e.reply('开始了');
  try {
    let num = e.msg.match(/(\d+)/);
    num = num && num[1] ? parseInt(num[1], 10) : 1;
    const messages = ['你要的图来啦'];
    let res;
    let imageUrls = []; // 用于存储所有图片链接
    res = await fetch(`${apiurl5}${num}`);
    res = await res.json();

    if (res && res.urls && res.urls.length > 0) {
      for (let i = 0; i < res.urls.length; i++) {
        const imageUrl = res.urls[i];
        messages.push(segment.image(imageUrl));
        imageUrls.push(imageUrl);
      }
    } else {
      return e.reply('API 返回的数据不正确，未能获取到图片信息。');
    }

    const forwardMsg = common.makeForwardMsg(e, messages, '点击查看涩图');
    let aw = await e.reply(forwardMsg);
    if (!aw && imageUrls.length > 1) {
      const allImageLinks = imageUrls.join('\n');
      await e.reply('消息被风控！\n' + allImageLinks);
    }
  } catch (error) {
    console.error(`Error in zt function: ${error.message}`);
  }
}





async bs(e) {
  try {
    const response = await fetch(apiurl3);
    const buffer = await response.buffer();
    const timestamp = new Date().getTime();
    const fileName = `${timestamp}.jpg`;
    const filePath = path.join(__dirname, `../resource/bs/${fileName}`);

    fs.writeFileSync(filePath, buffer, 'binary');

    await e.reply([segment.image(filePath)]);
  } catch (error) {
    await e.reply("出现了一点小问题，无法获取白丝图。" + error.message);
  }
}


  async ys(e) {
    await e.reply([segment.image(apiurl2)]);
  }
  async ptst(e) {
    try {
      const messages = ['你要的图片']
      messages.push([segment.image(`${apiurl}`)]);
      messages.push('from Fanji-plugin')
      let forward = await common.makeForwardMsg(e, messages, '涩图来啦')
      await e.reply(forward)
      return
    } catch (error) {
      await e.reply('出现了一点小问题');
      await e.reply(error.message);
    }
  }
  async fr(e) {
    try {
      await e.reply([segment.image(`${apiurl}?sort=furry`)]);
      return
    } catch (error) {
      await e.reply('出现了一点小问题');
      await e.reply(error.message);
    }
  }
  async r18(e) {
    try {
      // 解析命令中的张数，默认为1
      const match = e.msg.match(/^#?(来(\d+)张)?随机(r18)(图)?$/i);
      const numImages = match && match[2] ? parseInt(match[2]) : 1;
      if (numImages > 10 & !await cm.check(e.user_id)) {
        await e.reply('最多10张！！')
        return
      }
      const configContent = fs.readFileSync(filepath, 'utf8');
      let config = yaml.load(configContent);

      // 如果配置文件中没有 pixiv 项，则默认为 false 并创建该项
      if (!config.hasOwnProperty('pixiv')) {
        config.pixiv = false;
        const updatedConfigContent = yaml.dump(config);
        fs.writeFileSync(filepath, updatedConfigContent, 'utf8');
      }

      const pixivEnabled = config.pixiv;
      let fw = pixivEnabled ? '&proxy=imgaz.pixiv.net' : '';

      const requestOptions = {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
        },
        // 禁用证书验证
        agent: new https.Agent({
          rejectUnauthorized: false,
        }),
      };

      let url = await fetch(`${apiurl}?sort=r18&type=json&num=${numImages}`);
      url = await url.json();
      if (url.code === 200 && url.pics && url.pics.length > 0) {
        if (url.pics.length === 1) {
          // 只有一张图片的情况
          const imageUrl = url.pics[0];
          const response = await fetch(imageUrl, requestOptions);
          const buffer = await response.buffer();
          const timestamp = new Date().getTime();
          const imagePath = path.join(__dirname, `../resource/pixiv/${timestamp}_0.jpg`); // 修改为保存路径

          fs.writeFileSync(imagePath, buffer, 'binary');

          const forwardMsg = await common.makeForwardMsg(e, [segment.image(imagePath), '\nfrom fanji-plugin', segment.image(ymzx)], '你要的涩图来啦');
  res = await fetch(`${tosendurl2}${key}&url=${url.pics}`);
  const data = await res.json();

  if (data.code != 0) {
    await e.reply(`至云溪院API失败，code: ${data.code}, msg: ${data.msg}`);
  }
            let aw = await this.reply(forwardMsg);
            if (aw) {
              return;
            } else {

              aw = await this.reply(forwardMsg)
              if (aw) {
                return
              } else {
                await this.reply([`被吞了，图链:${url.pics}`]);
              }

            }
          
        } else {
          // 多张图片的情况
          const imagePromises = url.pics.map(async (imageUrl, index) => {
            // 下载图片并保存到指定路径
            const response = await fetch(imageUrl, requestOptions);
            const buffer = await response.buffer();
            const timestamp = new Date().getTime();
            const imagePath = path.join(__dirname, `../resource/pixiv/${timestamp}_${index}.jpg`);// 修改为保存路径

            fs.writeFileSync(imagePath, buffer, 'binary');
            return imagePath;
          });

          const imagePaths = await Promise.all(imagePromises);

          const messages = ['你的涩图来啦'];
          messages.push(segment.image(ymzx))
          messages.push(...imagePaths.map(imagePath => segment.image(imagePath)));
          messages.push('from 反击插件')
          const forward = messages;

          const forwardMsg = await common.makeForwardMsg(e, forward, '你要的涩图来啦');
  res = await fetch(`${tosendurl2}${key}&url=${url.pics.join('|')}`);
  const data = await res.json();

  if (data.code != 0) {
    await e.reply(`至云溪院API失败，code: ${data.code}, msg: ${data.msg}`);
  }
          let aw = await this.reply(forwardMsg);
          if (aw) {
            return;
          } else {
            const allImageLinks = url.pics.join('\n\n');
            await this.reply([`被吞了，图链:\n${allImageLinks}`]);
          }
        }
      } else {
        await e.reply('API 返回的数据不正确，未能获取到图片信息。');
      }
    } catch (error) {
      await e.reply('出现了一点小问题');
      await e.reply(error.message);
    }
  }



}
