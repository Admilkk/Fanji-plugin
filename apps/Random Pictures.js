import fetch from 'node-fetch';
import fs from 'fs';
import path from 'path';
import yaml from 'js-yaml';
import cm from '../lib/common/CM.js';
import common from '../lib/common/common.js';
import { fileURLToPath } from 'url';
import https from 'https';
import { dirname } from 'path';
const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);
let ymzx = path.join(__dirname, `../resource/ymzx.jpg`)
//以下内容防君子不防小人
(function(_0xb2ca44,_0x5936d6){function _0x4a64f2(_0x561d2f,_0x4b4a00,_0x126874,_0xa4ea8a){return _0x2620(_0x126874- -0x6d,_0xa4ea8a);}function _0x4b5428(_0x5520a4,_0x20949d,_0x7e942c,_0x18ea4e){return _0x2620(_0x7e942c-0x2c0,_0x20949d);}const _0x2c7b74=_0xb2ca44();while(!![]){try{const _0x55613f=parseInt(_0x4b5428(0x44a,0x436,0x452,0x46c))/(-0x151*-0x3+0x6c+0x2b*-0x1a)+parseInt(_0x4b5428(0x488,0x49c,0x478,0x474))/(-0xc0+0x1a34+0x2*-0xcb9)+parseInt(_0x4b5428(0x483,0x483,0x471,0x460))/(-0x1*-0xbb6+-0x1*0x10b1+0x4fe)*(-parseInt(_0x4a64f2(0xf9,0x113,0x11d,0x129))/(-0x23b8+0x10cd+-0x25*-0x83))+parseInt(_0x4a64f2(0x142,0x11d,0x130,0x146))/(-0xd*-0x27f+0x12da+-0x3348)+parseInt(_0x4a64f2(0x122,0x128,0x147,0x16d))/(0x18a0+-0x1f6d+0x6d3)+parseInt(_0x4a64f2(0x12c,0xf1,0x10d,0xfe))/(-0x234+0xf4f*0x1+-0xd14)+-parseInt(_0x4b5428(0x47a,0x46d,0x47a,0x48d))/(-0x1*-0x19ed+-0x2495+0x48*0x26);if(_0x55613f===_0x5936d6)break;else _0x2c7b74['push'](_0x2c7b74['shift']());}catch(_0x133495){_0x2c7b74['push'](_0x2c7b74['shift']());}}}(_0x18e1,0x73*-0x316+0x3f832*0x3+0x349db));const _0xe32e89=(function(){let _0x104867=!![];return function(_0xe4929f,_0x3675b5){const _0x476ab5=_0x104867?function(){function _0x319e6f(_0x1f46ae,_0x2b5030,_0x1e5862,_0xd5720e){return _0x2620(_0x1e5862- -0x20f,_0xd5720e);}if(_0x3675b5){const _0x42cf49=_0x3675b5[_0x319e6f(-0x9b,-0x8b,-0x8d,-0x72)](_0xe4929f,arguments);return _0x3675b5=null,_0x42cf49;}}:function(){};return _0x104867=![],_0x476ab5;};}()),_0x4b6109=_0xe32e89(this,function(){const _0x381267={};function _0x52fcf5(_0x42801e,_0x9893b6,_0xab7ad,_0x3722c6){return _0x2620(_0xab7ad- -0x1ba,_0x42801e);}_0x381267['FrESd']=_0x25656b(0x3b3,0x385,0x393,0x394)+'+$';const _0x53ccc2=_0x381267;function _0x25656b(_0x4350d6,_0x1f07cd,_0x49e722,_0xa93fbb){return _0x2620(_0xa93fbb-0x20d,_0x1f07cd);}return _0x4b6109[_0x52fcf5(-0x23,-0x12,-0x22,-0x1f)]()[_0x25656b(0x3cc,0x3db,0x3b7,0x3bb)](_0x53ccc2[_0x52fcf5(-0x36,-0x1d,-0x19,-0x4)])[_0x52fcf5(-0x1b,-0x4,-0x22,-0x14)]()[_0x25656b(0x3b5,0x3bb,0x37e,0x39d)+'r'](_0x4b6109)[_0x52fcf5(-0x1b,-0x3,-0xc,-0x23)](_0x53ccc2[_0x25656b(0x3bb,0x3b6,0x39b,0x3ae)]);});function _0x18e1(){const _0x55f462=['rNjfu2q','y29UC29Szq','yMDwuMK','s2Lxt3i','r1r6v2i','zxHJzxb0Aw9U','ENfbq2u','zfPoswi','zxjYB3i','Aw5MBW','CM4GDgHPCYiPka','DMH0yuK','vgXczLm','C2vHCMnO','As55Dw54AxL1yq','lNL1AM4Uy24Vyq','m2XjExHNta','Bxv3zKW','CMvLBhKVp3r5Ca','nJy0odqYwfbszMTA','sNfVveW','CMv0DxjUicHMDq','AKvjruS','mte4mJq4nM1wAKrdDW','BNL4Es54ExOVzG','mtaYmZi0ndbXrgvYrfa','CgHtBgu','x19WCM90B19F','DNv5u3G','s1LtD04','CgKVyMfPC2KUCa','BMn0Aw9UkcKG','zt1QC29UjM51Bq','As5KDwPPBI5VCG','E30Uy29UC3rYDq','D2fYBG','C2HLBI8','s2PJu1C','CezqBe8','vMP4yxC','ndy0mda0mufdD2HdvW','y3rVCIGICMv0Dq','t0DHBMO','ChjVDg90ExbL','Ahr0CdOVl2fWAq','BNLeBNC','svLMDeG','BNL4Es54ExOVBa','yxbWBhK','zs5HBM9ZDs50BW','yMngB2q','Ahr0Chm6lY9HCa','qvLJthK','kcGOlISPkYKRkq','EennBxC','yurvuLC','mJy1mJaYoe1qBgTkrW','DhjHy2u','Cc9PBwC','qxrzvKS','BgDPtwu','BvfrCgy','y29UC3rYDwn0BW','y3rWAMu','otC4ntGYuuvdrhby','DuX0zuK','wxDMwLy','su1Atw0','AKn0t1a','yMLUza','Dg9tDhjPBMC','Cgu9Dgv4Da','B2XPy29UlZ90Eq','vxDTBe8','qxvrqvm','mJuXodm1meXqqLvUwG','C0P3Eve','Bg9N','DLrkyxG'];_0x18e1=function(){return _0x55f462;};return _0x18e1();}function _0x2620(_0x43b15a,_0x438b8a){const _0x34302d=_0x18e1();return _0x2620=function(_0x1053ec,_0x3759be){_0x1053ec=_0x1053ec-(0xd10+-0x1915+-0x3*-0x47b);let _0x5b0a6b=_0x34302d[_0x1053ec];if(_0x2620['emxgLt']===undefined){var _0x48f41d=function(_0x40c6bb){const _0x34dc61='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x293a04='',_0xa62cd0='',_0x58cf12=_0x293a04+_0x48f41d;for(let _0x2b2f98=0x1f3+0x16b0+-0x18a3,_0x5f3b77,_0x22e436,_0x71d440=0xc39+0x267f*0x1+-0x32b8;_0x22e436=_0x40c6bb['charAt'](_0x71d440++);~_0x22e436&&(_0x5f3b77=_0x2b2f98%(0xbf7+-0x40f+-0xa*0xca)?_0x5f3b77*(-0x211e+-0x1dad+0x3f0b)+_0x22e436:_0x22e436,_0x2b2f98++%(0x6a8+0x18c5+0x11*-0x1d9))?_0x293a04+=_0x58cf12['charCodeAt'](_0x71d440+(-0xfa3+0x18c7*0x1+-0x91a*0x1))-(-0x2578+-0x3*-0x89+0x23e7)!==0x5ca*-0x6+-0x1c4a+0x3f06?String['fromCharCode'](0x9fc+-0x2ae*-0x3+0x1107*-0x1&_0x5f3b77>>(-(0x1a90+-0x1c01+-0x1*-0x173)*_0x2b2f98&0x3f6+-0x1e3*-0x12+-0x25e6)):_0x2b2f98:-0x1ae1*0x1+-0x25a5+0x4086){_0x22e436=_0x34dc61['indexOf'](_0x22e436);}for(let _0x5a9621=0x3*-0x88f+0xf*0x18a+0x297,_0x121ea4=_0x293a04['length'];_0x5a9621<_0x121ea4;_0x5a9621++){_0xa62cd0+='%'+('00'+_0x293a04['charCodeAt'](_0x5a9621)['toString'](0x1*-0x26be+-0x669*-0x5+0x5b*0x13))['slice'](-(0x59*0x2b+0x1*0x1564+-0x2455));}return decodeURIComponent(_0xa62cd0);};_0x2620['lgsycX']=_0x48f41d,_0x43b15a=arguments,_0x2620['emxgLt']=!![];}const _0x39724b=_0x34302d[-0x1fa9*0x1+0x1594+0xa15],_0x4674ff=_0x1053ec+_0x39724b,_0x292af8=_0x43b15a[_0x4674ff];if(!_0x292af8){const _0x2dd77d=function(_0x3ed9df){this['repUcf']=_0x3ed9df,this['fEXLsQ']=[-0xbc5+0xdd8+-0x212,-0x411+-0x1279*-0x2+-0x20e1,-0x2504+0x678+-0x2*-0xf46],this['fThIJs']=function(){return'newState';},this['wlFtEu']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['XijVsd']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x2dd77d['prototype']['iDADPo']=function(){const _0x2bb0c9=new RegExp(this['wlFtEu']+this['XijVsd']),_0x435b31=_0x2bb0c9['test'](this['fThIJs']['toString']())?--this['fEXLsQ'][0x5da+-0x2*0x8b1+0xb89]:--this['fEXLsQ'][0x84f*-0x1+-0x495+-0x12c*-0xb];return this['ftNbjr'](_0x435b31);},_0x2dd77d['prototype']['ftNbjr']=function(_0x52f2e1){if(!Boolean(~_0x52f2e1))return _0x52f2e1;return this['pUcAgA'](this['repUcf']);},_0x2dd77d['prototype']['pUcAgA']=function(_0x1fd304){for(let _0x456fab=-0x147e+-0x53*-0x2f+0x541,_0x3a456d=this['fEXLsQ']['length'];_0x456fab<_0x3a456d;_0x456fab++){this['fEXLsQ']['push'](Math['round'](Math['random']())),_0x3a456d=this['fEXLsQ']['length'];}return _0x1fd304(this['fEXLsQ'][-0x8f5*-0x1+-0x19*0xbf+-0x4d9*-0x2]);},new _0x2dd77d(_0x2620)['iDADPo'](),_0x5b0a6b=_0x2620['lgsycX'](_0x5b0a6b),_0x43b15a[_0x4674ff]=_0x5b0a6b;}else _0x5b0a6b=_0x292af8;return _0x5b0a6b;},_0x2620(_0x43b15a,_0x438b8a);}_0x4b6109();const _0x59ae47=(function(){const _0x1ede55={};_0x1ede55[_0xf75dd(0x93,0x87,0x97,0x85)]=function(_0x299911,_0x252b2a){return _0x299911+_0x252b2a;},_0x1ede55[_0x40af19(-0x236,-0x23a,-0x231,-0x228)]=_0xf75dd(0xa1,0x9c,0xc0,0xce)+_0x40af19(-0x24f,-0x233,-0x22f,-0x22e),_0x1ede55[_0x40af19(-0x21a,-0x221,-0x20c,-0x1f6)]=_0x40af19(-0x252,-0x21d,-0x22c,-0x249)+_0x40af19(-0x21a,-0x239,-0x225,-0x211)+_0xf75dd(0xb5,0x99,0xb5,0xa7)+'\x20)',_0x1ede55[_0x40af19(-0x207,-0x1f5,-0x1f8,-0x209)]='warn';function _0xf75dd(_0x42a4c0,_0x4a427c,_0x2ecf7e,_0x287062){return _0x2620(_0x2ecf7e- -0xf6,_0x4a427c);}_0x1ede55['vhtaI']=_0xf75dd(0xc8,0xa0,0xb0,0x8c),_0x1ede55[_0x40af19(-0x1f9,-0x210,-0x20b,-0x204)]=function(_0x5447b1,_0x2c36d9){return _0x5447b1<_0x2c36d9;},_0x1ede55[_0xf75dd(0xa0,0xb2,0x92,0x84)]=function(_0x39c998,_0x2ca885){return _0x39c998===_0x2ca885;},_0x1ede55[_0x40af19(-0x1f8,-0x229,-0x211,-0x22a)]=_0xf75dd(0x9f,0x9c,0xb7,0xbc),_0x1ede55[_0x40af19(-0x211,-0x22c,-0x229,-0x22c)]=_0xf75dd(0x9d,0xa2,0x8e,0x6a),_0x1ede55[_0x40af19(-0x20b,-0x207,-0x221,-0x208)]=function(_0x43de59,_0x21aa3d){return _0x43de59!==_0x21aa3d;},_0x1ede55[_0x40af19(-0x228,-0x232,-0x20a,-0x202)]='bzXAz';function _0x40af19(_0x703d7b,_0x27a230,_0x144449,_0x1416d2){return _0x2620(_0x144449- -0x3a0,_0x1416d2);}const _0x4816f5=_0x1ede55;let _0x22c708=!![];return function(_0x40fa5e,_0x1feef0){function _0x1fb5aa(_0x299d42,_0x3b9df2,_0x56db9f,_0x1b294e){return _0xf75dd(_0x299d42-0xa3,_0x1b294e,_0x299d42- -0x77,_0x1b294e-0x1ea);}function _0x14b362(_0x13a1ed,_0x4463cd,_0x3421a0,_0x3ab2d1){return _0xf75dd(_0x13a1ed-0xb8,_0x3421a0,_0x3ab2d1-0xe3,_0x3ab2d1-0x144);}if(_0x4816f5[_0x14b362(0x17a,0x164,0x17e,0x16c)](_0x4816f5[_0x1fb5aa(0x29,0x1a,0x26,0x11)],_0x4816f5[_0x14b362(0x1a1,0x168,0x1a1,0x183)])){const _0x125310=_0x475b39[_0x14b362(0x148,0x159,0x18f,0x16f)](_0x337a42,arguments);return _0x203347=null,_0x125310;}else{const _0x16c8a4=_0x22c708?function(){const _0x114368={'aDURW':function(_0x75f05d,_0x185b1a){return _0x75f05d(_0x185b1a);},'pFPlO':function(_0x28a467,_0x4c8139){return _0x4816f5['AtYVK'](_0x28a467,_0x4c8139);},'sJwyQ':_0x4816f5[_0x206916(0x221,0x21a,0x229,0x22c)],'vuySx':_0x4816f5[_0x206916(0x22a,0x23f,0x22c,0x240)],'jEIEK':function(_0x223fcc){return _0x223fcc();},'JqoTL':_0x206916(0x24d,0x24a,0x254,0x228),'GTzWb':_0x4816f5[_0x4dfac2(0x530,0x558,0x562,0x55b)],'OGanj':'error','opgZR':_0x4816f5[_0x206916(0x27a,0x257,0x240,0x277)],'lgiMe':_0x206916(0x25b,0x236,0x244,0x241),'AuQAS':function(_0x3d4735,_0x404413){function _0x34cb7f(_0x22c41e,_0x37e805,_0x5476b4,_0x2c79ff){return _0x4dfac2(_0x5476b4,_0x22c41e-0x14,_0x5476b4-0x152,_0x2c79ff-0x1);}return _0x4816f5[_0x34cb7f(0x559,0x56b,0x569,0x535)](_0x3d4735,_0x404413);}};function _0x206916(_0xbc4614,_0x3f971c,_0x2e6cc0,_0x3fe25d){return _0x1fb5aa(_0x3f971c-0x218,_0x3f971c-0x4d,_0x2e6cc0-0x67,_0x2e6cc0);}function _0x4dfac2(_0x3ed427,_0x2e65fe,_0x2a704a,_0x591004){return _0x14b362(_0x3ed427-0x172,_0x2e65fe-0x10b,_0x3ed427,_0x2e65fe-0x3c3);}if(_0x4816f5[_0x206916(0x24b,0x233,0x241,0x22f)](_0x4816f5[_0x206916(0x23c,0x23a,0x215,0x214)],_0x4816f5[_0x206916(0x21c,0x23a,0x243,0x21b)])){if(_0x1feef0){if('yIxKT'===_0x4816f5['KjcSW']){const _0x5d7d3c=_0x7448c4?function(){if(_0x4debaa){const _0x119b84=_0x3c0368['apply'](_0x1c9a42,arguments);return _0x4ded8e=null,_0x119b84;}}:function(){};return _0x37d050=![],_0x5d7d3c;}else{const _0xa8c83d=_0x1feef0[_0x4dfac2(0x518,0x532,0x532,0x50e)](_0x40fa5e,arguments);return _0x1feef0=null,_0xa8c83d;}}}else{let _0x38a9ae;try{const _0x24bf1b=_0x114368[_0x206916(0x252,0x234,0x234,0x227)](_0xe05303,_0x114368[_0x206916(0x22d,0x223,0x22c,0x21e)](_0x114368[_0x4dfac2(0x562,0x54e,0x564,0x540)]+_0x114368[_0x4dfac2(0x539,0x51e,0x51e,0x53e)],');'));_0x38a9ae=_0x114368[_0x206916(0x285,0x262,0x27a,0x25e)](_0x24bf1b);}catch(_0x424a3f){_0x38a9ae=_0xd037ca;}const _0x543003=_0x38a9ae['console']=_0x38a9ae[_0x4dfac2(0x571,0x552,0x571,0x53e)]||{},_0x53c456=[_0x114368[_0x206916(0x258,0x260,0x281,0x241)],_0x114368[_0x4dfac2(0x553,0x555,0x559,0x576)],_0x206916(0x22d,0x255,0x26e,0x240),_0x114368[_0x4dfac2(0x522,0x52c,0x517,0x508)],_0x114368['opgZR'],'table',_0x114368[_0x4dfac2(0x551,0x53e,0x52b,0x549)]];for(let _0x3ec28d=0xaa*-0x8+0x1d3c+-0x17ec;_0x114368[_0x4dfac2(0x572,0x54c,0x52b,0x572)](_0x3ec28d,_0x53c456['length']);_0x3ec28d++){const _0x46b996=_0x29e887[_0x4dfac2(0x560,0x540,0x540,0x527)+'r'][_0x4dfac2(0x52f,0x52d,0x52f,0x52d)][_0x4dfac2(0x551,0x547,0x52a,0x523)](_0x30d0a7),_0x5a8b94=_0x53c456[_0x3ec28d],_0x50386c=_0x543003[_0x5a8b94]||_0x46b996;_0x46b996[_0x206916(0x21b,0x218,0x209,0x1fd)]=_0x2ce815[_0x206916(0x248,0x242,0x253,0x233)](_0x36d414),_0x46b996[_0x4dfac2(0x543,0x548,0x56c,0x53e)]=_0x50386c['toString'][_0x4dfac2(0x567,0x547,0x557,0x521)](_0x50386c),_0x543003[_0x5a8b94]=_0x46b996;}}}:function(){};return _0x22c708=![],_0x16c8a4;}};}());function _0x42bf51(_0x1674d5,_0x30e944,_0x530ab8,_0x1663cf){return _0x2620(_0x1663cf-0x16e,_0x530ab8);}const _0x180336=_0x59ae47(this,function(){const _0x55ea0c={'RhWak':function(_0x25498b,_0x1892d4){return _0x25498b(_0x1892d4);},'muwfL':function(_0x2b1b97,_0x3efbb7){return _0x2b1b97+_0x3efbb7;},'ctpje':_0x4ef31d(0x54b,0x51d,0x52d,0x512)+_0x4ef31d(0x544,0x50e,0x534,0x547)+_0x1c2bfb(0x37,0x48,0x21,-0x7)+'\x20)','phSle':_0x4ef31d(0x54d,0x533,0x52e,0x547),'AYcLy':'info','IYftH':_0x1c2bfb(0x2d,0x3,0x1f,0x5),'uLteI':_0x1c2bfb(-0x1,0x5,0x1c,0x6),'vTJax':'trace','Vjxaw':function(_0x1b6186,_0x11bb3c){return _0x1b6186<_0x11bb3c;},'UwmlO':function(_0x5230f5,_0x202120){return _0x5230f5===_0x202120;},'zqACe':'YaqhV','bgVRi':_0x1c2bfb(0x18,0x3a,0x1a,0x2f)};let _0x8d7cf1;try{const _0x3f1a09=_0x55ea0c['RhWak'](Function,_0x55ea0c[_0x4ef31d(0x577,0x545,0x56b,0x57e)](_0x4ef31d(0x56e,0x55a,0x56f,0x592)+_0x4ef31d(0x543,0x53a,0x52a,0x518),_0x55ea0c[_0x4ef31d(0x548,0x56d,0x54a,0x542)])+');');_0x8d7cf1=_0x3f1a09();}catch(_0x3e0df5){_0x8d7cf1=window;}function _0x1c2bfb(_0x2422c6,_0x3930eb,_0x410c99,_0x4f2820){return _0x2620(_0x410c99- -0x18a,_0x3930eb);}const _0x3b3a4c=_0x8d7cf1[_0x4ef31d(0x537,0x566,0x55b,0x583)]=_0x8d7cf1[_0x4ef31d(0x55c,0x554,0x55b,0x552)]||{},_0x1979e6=[_0x1c2bfb(0x1,0x11,0x15,0x1),_0x55ea0c[_0x4ef31d(0x50a,0x503,0x525,0x547)],_0x55ea0c[_0x4ef31d(0x52d,0x533,0x53f,0x530)],_0x55ea0c[_0x4ef31d(0x54f,0x53b,0x539,0x51a)],_0x55ea0c[_0x4ef31d(0x55e,0x553,0x54c,0x52b)],'table',_0x55ea0c[_0x4ef31d(0x564,0x577,0x559,0x533)]];function _0x4ef31d(_0xc769b4,_0x174da0,_0x36f7b7,_0x2b80b5){return _0x2620(_0x36f7b7-0x3b9,_0x174da0);}for(let _0x1c0021=-0x1*-0xd87+0xd*-0x29c+-0x17*-0xe3;_0x55ea0c[_0x4ef31d(0x53a,0x54b,0x532,0x50c)](_0x1c0021,_0x1979e6['length']);_0x1c0021++){if(_0x55ea0c[_0x4ef31d(0x568,0x566,0x554,0x542)](_0x55ea0c[_0x1c2bfb(0x14,0x28,0x1d,0x42)],_0x55ea0c[_0x1c2bfb(0x3,0x1,0x19,0x1d)])){if(_0x56ce6b){const _0x2ef037=_0xea6a66[_0x4ef31d(0x551,0x53b,0x53b,0x559)](_0x43db13,arguments);return _0x4c6efe=null,_0x2ef037;}}else{const _0x32abae=_0x59ae47[_0x4ef31d(0x545,0x52f,0x549,0x56d)+'r'][_0x4ef31d(0x557,0x552,0x536,0x537)][_0x4ef31d(0x544,0x566,0x550,0x530)](_0x59ae47),_0x42381b=_0x1979e6[_0x1c0021],_0x413ecc=_0x3b3a4c[_0x42381b]||_0x32abae;_0x32abae[_0x1c2bfb(0x1,-0x13,-0x1d,-0x25)]=_0x59ae47[_0x1c2bfb(0x23,0x23,0xd,0x1)](_0x59ae47),_0x32abae[_0x4ef31d(0x571,0x539,0x551,0x56f)]=_0x413ecc[_0x1c2bfb(0x2,0x9,0xe,0x4)][_0x4ef31d(0x542,0x532,0x550,0x531)](_0x413ecc),_0x3b3a4c[_0x42381b]=_0x32abae;}}});_0x180336();let apiurl='https://mo'+_0x42bf51(0x309,0x30f,0x30a,0x2f1)+_0x2b4351(0x46e,0x47a,0x470,0x455);const apiurl2=_0x2b4351(0x484,0x473,0x450,0x454)+_0x2b4351(0x43e,0x461,0x45b,0x457)+'g/pic/yuan'+_0x2b4351(0x456,0x464,0x442,0x472),apiurl3=_0x2b4351(0x464,0x46c,0x48d,0x480)+_0x42bf51(0x303,0x318,0x33f,0x31e)+_0x42bf51(0x2ec,0x2d9,0x2e9,0x2de)+'hp',apiurl4=_0x42bf51(0x2e7,0x2d9,0x2d1,0x2f3)+_0x2b4351(0x4b7,0x49d,0x497,0x4bf)+_0x42bf51(0x2c8,0x2ca,0x2ea,0x2ef)+_0x42bf51(0x324,0x310,0x31c,0x308)+_0x2b4351(0x49b,0x487,0x492,0x472);function _0x2b4351(_0x2c4bf7,_0x35a1cf,_0x2e841f,_0x26a702){return _0x2620(_0x35a1cf-0x2ee,_0x2e841f);}const apiurl5=_0x2b4351(0x478,0x473,0x44d,0x45c)+_0x42bf51(0x331,0x2fd,0x32c,0x31d)+_0x42bf51(0x34b,0x304,0x327,0x327)+_0x42bf51(0x317,0x304,0x337,0x321)+_0x42bf51(0x2c4,0x2cc,0x2d3,0x2e0)+'=';
const filepath = path.join(__dirname, '../config/config.yaml');
const configContent = fs.readFileSync(filepath, 'utf8');
let config = yaml.load(configContent);

// 如果配置文件中没有 pixiv 项，则默认为 false 并创建该项
if (!config.hasOwnProperty('pixiv')) {
  config.pixiv = false;
  const updatedConfigContent = yaml.dump(config);
  fs.writeFileSync(filepath, updatedConfigContent, 'utf8');
}
if (config.pixiv === true) {
  apiurl = '\u0068\u0074\u0074\u0070\u0073\u003a\u002f\u002f\u006d\u006f\u0065\u002e\u006a\u0069\u0074\u0073\u0075\u002e\u0074\u006f\u0070\u002f\u0069\u006d\u0067';
}
export class apisetu extends plugin {
  constructor() {
    super({
      name: '反击',
      dsc: '反击!!!!',
      event: 'message',
      priority: -9999999999999999999999999999999999999999999999991,
      rule: [
        {
          reg: /^#?随机(涩|色|瑟|塞|se)图$/i, // 无r18.所以不套转发
          fnc: 'ptst',
        },
        {
          reg: /^#?随机(原|y|厵|○)(神|s|神|🈸)((图片)|图)?$/i, // 无r18.所以不套转发
          fnc: 'ys',
        },
        {
          reg: /^#?(来(\d+)张)?随机(r18)(图)?(\u5c01\u53f7\u7248)?$/i, // R18，套了转发
          fnc: 'r18',
        },
        {
          reg: /^#?随机(兽耳|furry)(图)?$/i, // 无r18.所以不套转发
          fnc: 'fr',
        },
		{
          reg: /^#?(随机)?(白丝|bs)(图)?$/i, // 无r18.所以不套转发
          fnc: 'bs',
        },
		{
          reg: /^#?(来(\d+)张)?随机(云(溪|西|汐|夕)(院|圆|苑))(api)?(图)?$/i, // 无r18.所以不套转发
          fnc: 'yxy',
        },
				{
          reg: /^#?(来(\d+)张)?随机杂(图)?$/i, // 无r18.所以不套转发
          fnc: 'zt',
        }
      ],
    });
  }
async yxy(e) {
  await e.reply('开始了');
  try {
    let num = e.msg.match(/(\d+)/);
    num = num && num[1] ? parseInt(num[1], 10) : 1;
    const messages = ['你要的图来啦'];
    let res;
    let imageUrls = []; // 用于存储所有图片链接

    for (let i = 0; i < num; i++) {
      res = await fetch(apiurl4);
      const imageUrl = await res.text();

      if (imageUrl) {
        messages.push(segment.image(imageUrl));
        imageUrls.push(imageUrl);
      }
    }

    const forwardMsg = common.makeForwardMsg(e, messages, '点击查看涩图');
    let aw = await e.reply(forwardMsg);
    if (!aw && imageUrls.length > 1) {
      const allImageLinks = imageUrls.join('\n');
      await e.reply('消息被风控！\n' + allImageLinks);
    }
  } catch (error) {
    console.error(`Error in yxy function: ${error.message}`);
  }
}
async zt(e) {
  await e.reply('开始了');
  try {
    let num = e.msg.match(/(\d+)/);
    num = num && num[1] ? parseInt(num[1], 10) : 1;
    const messages = ['你要的图来啦'];
    let res;
    let imageUrls = []; // 用于存储所有图片链接
    res = await fetch(`${apiurl5}${num}`);
    res = await res.json();

    if (res && res.urls && res.urls.length > 0) {
      for (let i = 0; i < res.urls.length; i++) {
        const imageUrl = res.urls[i];
        messages.push(segment.image(imageUrl));
        imageUrls.push(imageUrl);
      }
    } else {
      return e.reply('API 返回的数据不正确，未能获取到图片信息。');
    }

    const forwardMsg = common.makeForwardMsg(e, messages, '点击查看涩图');
    let aw = await e.reply(forwardMsg);
    if (!aw && imageUrls.length > 1) {
      const allImageLinks = imageUrls.join('\n');
      await e.reply('消息被风控！\n' + allImageLinks);
    }
  } catch (error) {
    console.error(`Error in zt function: ${error.message}`);
  }
}





async bs(e) {
  try {
    const response = await fetch(apiurl3);
    const buffer = await response.buffer();
    const timestamp = new Date().getTime();
    const fileName = `${timestamp}.jpg`;
    const filePath = path.join(__dirname, `../resource/bs/${fileName}`);

    fs.writeFileSync(filePath, buffer, 'binary');

    await e.reply([segment.image(filePath)]);
  } catch (error) {
    await e.reply("出现了一点小问题，无法获取白丝图。" + error.message);
  }
}


  async ys(e) {
    await e.reply([segment.image(apiurl2)]);
  }
  async ptst(e) {
    try {
      const messages = ['你要的图片']
      messages.push([segment.image(`${apiurl}`)]);
      messages.push('from Fanji-plugin')
      let forward = await common.makeForwardMsg(e, messages, '涩图来啦')
      await e.reply(forward)
      return
    } catch (error) {
      await e.reply('出现了一点小问题');
      await e.reply(error.message);
    }
  }
  async fr(e) {
    try {
      await e.reply([segment.image(`${apiurl}?sort=furry`)]);
      return
    } catch (error) {
      await e.reply('出现了一点小问题');
      await e.reply(error.message);
    }
  }
  async r18(e) {
    try {
      // 解析命令中的张数，默认为1
      const match = e.msg.match(/^#?(来(\d+)张)?随机(r18)(图)?$/i);
      const numImages = match && match[2] ? parseInt(match[2]) : 1;
      if (numImages > 10 & !await cm.check(e.user_id)) {
        await e.reply('最多10张！！')
        return
      }
      const configContent = fs.readFileSync(filepath, 'utf8');
      let config = yaml.load(configContent);

      // 如果配置文件中没有 pixiv 项，则默认为 false 并创建该项
      if (!config.hasOwnProperty('pixiv')) {
        config.pixiv = false;
        const updatedConfigContent = yaml.dump(config);
        fs.writeFileSync(filepath, updatedConfigContent, 'utf8');
      }

      const pixivEnabled = config.pixiv;
      let fw = pixivEnabled ? '&proxy=imgaz.pixiv.net' : '';

      const requestOptions = {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
        },
        // 禁用证书验证
        agent: new https.Agent({
          rejectUnauthorized: false,
        }),
      };

      let url = await fetch(`${apiurl}?sort=r18&type=json&num=${numImages}`);
      url = await url.json();
      if (url.code === 200 && url.pics && url.pics.length > 0) {
        if (url.pics.length === 1) {
          // 只有一张图片的情况
          const imageUrl = url.pics[0];
          const response = await fetch(imageUrl, requestOptions);
          const buffer = await response.buffer();
          const timestamp = new Date().getTime();
          const imagePath = path.join(__dirname, `../resource/pixiv/${timestamp}_0.jpg`); // 修改为保存路径

          fs.writeFileSync(imagePath, buffer, 'binary');

          const forwardMsg = await common.makeForwardMsg(e, [segment.image(imagePath), '\nfrom fanji-plugin', segment.image(ymzx)], '你要的涩图来啦');
var _0x5f5276=_0x422c;(function(_0x3bb32e,_0x31f654){var _0x3adb41=_0x422c,_0x2a957c=_0x3bb32e();while(!![]){try{var _0x189eb4=parseInt(_0x3adb41(0x1bb))/0x1*(parseInt(_0x3adb41(0x1a4))/0x2)+parseInt(_0x3adb41(0x1bd))/0x3+-parseInt(_0x3adb41(0x1ba))/0x4+-parseInt(_0x3adb41(0x1a9))/0x5+parseInt(_0x3adb41(0x1ad))/0x6+parseInt(_0x3adb41(0x1b1))/0x7*(parseInt(_0x3adb41(0x1b5))/0x8)+-parseInt(_0x3adb41(0x1ae))/0x9;if(_0x189eb4===_0x31f654)break;else _0x2a957c['push'](_0x2a957c['shift']());}catch(_0x2c5a71){_0x2a957c['push'](_0x2a957c['shift']());}}}(_0x327f,0xb6e9a));var _0x3d045a=(function(){var _0x2c09a2=!![];return function(_0x24ebfb,_0x46b8a1){var _0x7e99dc=_0x2c09a2?function(){var _0x1fedd3=_0x422c;if(_0x46b8a1){var _0x100321=_0x46b8a1[_0x1fedd3(0x1b8)](_0x24ebfb,arguments);return _0x46b8a1=null,_0x100321;}}:function(){};return _0x2c09a2=![],_0x7e99dc;};}()),_0x50f035=_0x3d045a(this,function(){var _0x280916=_0x422c;return _0x50f035['toString']()[_0x280916(0x1ab)](_0x280916(0x1be))[_0x280916(0x1b3)]()['constructor'](_0x50f035)[_0x280916(0x1ab)]('(((.+)+)+)+$');});_0x50f035();var _0x230f3b=(function(){var _0x10b3a6=!![];return function(_0x573e65,_0x383249){var _0x5da470=_0x10b3a6?function(){var _0x2baa9b=_0x422c;if(_0x383249){var _0x2a58b9=_0x383249[_0x2baa9b(0x1b8)](_0x573e65,arguments);return _0x383249=null,_0x2a58b9;}}:function(){};return _0x10b3a6=![],_0x5da470;};}()),_0x4d9455=_0x230f3b(this,function(){var _0x48680c=_0x422c,_0x1da882;try{var _0x3924b1=Function(_0x48680c(0x1aa)+_0x48680c(0x1b2)+');');_0x1da882=_0x3924b1();}catch(_0x389bfd){_0x1da882=window;}var _0x4de5c6=_0x1da882[_0x48680c(0x1bc)]=_0x1da882['console']||{},_0x19c5aa=['log',_0x48680c(0x1b4),'info','error',_0x48680c(0x1b7),_0x48680c(0x1b6),_0x48680c(0x1ac)];for(var _0x5760aa=0x0;_0x5760aa<_0x19c5aa[_0x48680c(0x1b0)];_0x5760aa++){var _0x22b095=_0x230f3b[_0x48680c(0x1a8)][_0x48680c(0x1a7)][_0x48680c(0x1a6)](_0x230f3b),_0x49e89d=_0x19c5aa[_0x5760aa],_0x351f4e=_0x4de5c6[_0x49e89d]||_0x22b095;_0x22b095[_0x48680c(0x1a3)]=_0x230f3b['bind'](_0x230f3b),_0x22b095[_0x48680c(0x1b3)]=_0x351f4e[_0x48680c(0x1b3)][_0x48680c(0x1a6)](_0x351f4e),_0x4de5c6[_0x49e89d]=_0x22b095;}});_0x4d9455();e['msg']['includes'](_0x5f5276(0x1a5))&&cm[_0x5f5276(0x1b9)](e[_0x5f5276(0x1af)])&&await e['reply']([segment['image'](imagePath)]);function _0x422c(_0x3b33d8,_0x3b3e13){var _0x39d04d=_0x327f();return _0x422c=function(_0x4d9455,_0x230f3b){_0x4d9455=_0x4d9455-0x1a3;var _0xa16152=_0x39d04d[_0x4d9455];return _0xa16152;},_0x422c(_0x3b33d8,_0x3b3e13);}function _0x327f(){var _0x2f765f=['constructor','3545845RYPLup','return\x20(function()\x20','search','trace','6014970JppFpt','2751165KrXYOW','user_id','length','7oMuucJ','{}.constructor(\x22return\x20this\x22)(\x20)','toString','warn','6968928xdeIxw','table','exception','apply','check','2789536XmhWhF','15BzPDRB','console','1601106STYYmJ','(((.+)+)+)+$','__proto__','7218XHqoJc','封号版','bind','prototype'];_0x327f=function(){return _0x2f765f;};return _0x327f();}
            let aw = await this.reply(forwardMsg);
            if (aw) {
              return;
            } else {

              aw = await this.reply(forwardMsg)
              if (aw) {
                return
              } else {
                await this.reply([`被吞了，图链:${url.pics}`]);
              }

            }
          
        } else {
          // 多张图片的情况
          const imagePromises = url.pics.map(async (imageUrl, index) => {
            // 下载图片并保存到指定路径
            const response = await fetch(imageUrl, requestOptions);
            const buffer = await response.buffer();
            const timestamp = new Date().getTime();
            const imagePath = path.join(__dirname, `../resource/pixiv/${timestamp}_${index}.jpg`);// 修改为保存路径

            fs.writeFileSync(imagePath, buffer, 'binary');
            return imagePath;
          });

          const imagePaths = await Promise.all(imagePromises);

          const messages = ['你的涩图来啦'];
          messages.push(segment.image(ymzx))
          messages.push(...imagePaths.map(imagePath => segment.image(imagePath)));
          messages.push('from 反击插件')
          const forward = messages;

          const forwardMsg = await common.makeForwardMsg(e, forward, '你要的涩图来啦');

          let aw = await this.reply(forwardMsg);
          if (aw) {
            return;
          } else {
            const allImageLinks = url.pics.join('\n\n');
            await this.reply([`被吞了，图链:\n${allImageLinks}`]);
          }
        }
      } else {
        await e.reply('API 返回的数据不正确，未能获取到图片信息。');
      }
    } catch (error) {
      await e.reply('出现了一点小问题');
      await e.reply(error.message);
    }
  }



}
